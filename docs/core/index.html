<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="../logo.svg">
<link rel="stylesheet" href="../tango.css" type="text/css">
<link rel="stylesheet" href="../mccole.css" type="text/css">
<title>The Querynomicon &middot; Core Features</title>
<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']]
    }
  };
</script>
<script
  type="text/javascript"
  id="MathJax-script"
  async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

  <script defer data-domain="gvwilson.github.io/sql-tutorial" src="https://plausible.io/js/plausible.js"></script>


  </head>
  <body>
    <main>
      <div class="row notex">
  <div class="col-12 center">
    
      <h1>Core Features</h1>
    
  </div>
</div>

      
<nav class="row-always notex">
  <div class="col-1 left">
    <a href="../intro/" title="previous" class="undecorated">&#8678;</a>
  </div>
  <div class="col-10 center">
    <a href="../" title="home" class="undecorated">&#9737;</a>
  </div>
  <div class="col-1 right">
    <a href="../tools/" title="next" class="undecorated">&#8680;</a>
  </div>
</nav>


      
      <p class="terms">Terms defined: 
<a class="gl-ref" href="../glossary/#gl:admin_command" markdown="1">administration command</a>, <a class="gl-ref" href="../glossary/#gl:aggregation" markdown="1">aggregation</a>, <a class="gl-ref" href="../glossary/#gl:aggregation_func" markdown="1">aggregation function</a>, <a class="gl-ref" href="../glossary/#gl:cross_join" markdown="1">cross join</a>, <a class="gl-ref" href="../glossary/#gl:exclusive_or" markdown="1">exclusive or</a>, <a class="gl-ref" href="../glossary/#gl:filter" markdown="1">filter</a>, <a class="gl-ref" href="../glossary/#gl:full_outer_join" markdown="1">full outer join</a>, <a class="gl-ref" href="../glossary/#gl:group" markdown="1">group</a>, <a class="gl-ref" href="../glossary/#gl:in_memory_db" markdown="1">in-memory database</a>, <a class="gl-ref" href="../glossary/#gl:inclusive_or" markdown="1">inclusive or</a>, <a class="gl-ref" href="../glossary/#gl:join" markdown="1">join</a>, <a class="gl-ref" href="../glossary/#gl:join_condition" markdown="1">join condition</a>, <a class="gl-ref" href="../glossary/#gl:left_outer_join" markdown="1">left outer join</a>, <a class="gl-ref" href="../glossary/#gl:null" markdown="1">null</a>, <a class="gl-ref" href="../glossary/#gl:query" markdown="1">query</a>, <a class="gl-ref" href="../glossary/#gl:right_outer_join" markdown="1">right outer join</a>, <a class="gl-ref" href="../glossary/#gl:ternary_logic" markdown="1">ternary logic</a>, <a class="gl-ref" href="../glossary/#gl:tombstone" markdown="1">tombstone</a>
</p>
      <h2>Selecting Constant</h2>
<div class="language-sql" title="select_1.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="select_1.out">
<div class="highlight"><pre><span></span><code>1
</code></pre></div>
</div>
<ul>
<li><code>select</code> is a keyword</li>
<li>Normally used to select data from table…</li>
<li>…but if all we want is a constant value, we don&rsquo;t need to specify one</li>
<li>Semi-colon terminator is required</li>
</ul>
<h2>Selecting All Values from Table</h2>
<div class="language-sql" title="select_star.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">little_penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="select_star.out">
<div class="highlight"><pre><span></span><code>Gentoo|Biscoe|51.3|14.2|218.0|5300.0|MALE
Adelie|Dream|35.7|18.0|202.0|3550.0|FEMALE
Adelie|Torgersen|36.6|17.8|185.0|3700.0|FEMALE
Chinstrap|Dream|55.8|19.8|207.0|4000.0|MALE
Adelie|Dream|38.1|18.6|190.0|3700.0|FEMALE
Adelie|Dream|36.2|17.3|187.0|3300.0|FEMALE
Adelie|Dream|39.5|17.8|188.0|3300.0|FEMALE
Gentoo|Biscoe|42.6|13.7|213.0|4950.0|FEMALE
Gentoo|Biscoe|52.1|17.0|230.0|5550.0|MALE
Adelie|Torgersen|36.7|18.8|187.0|3800.0|FEMALE
</code></pre></div>
</div>
<ul>
<li>An actual <a class="gl-ref" href="../glossary/#gl:query" markdown="1">query</a></li>
<li>Use <code>*</code> to mean &ldquo;all columns&rdquo;</li>
<li>Use <code>from <em>tablename</em></code> to specify table</li>
<li>Output format is not particularly readable</li>
</ul>
<h2 class="aside">Administrative Commands</h2>
<div class="language-sql" title="admin_commands.sql">
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="n">headers</span><span class="w"> </span><span class="k">on</span>
<span class="p">.</span><span class="k">mode</span><span class="w"> </span><span class="n">markdown</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">little_penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="admin_commands.out">
<div class="highlight"><pre><span></span><code>|  species  |  island   | bill_length_mm | bill_depth_mm | flipper_length_mm | body_mass_g |  sex   |
|-----------|-----------|----------------|---------------|-------------------|-------------|--------|
| Gentoo    | Biscoe    | 51.3           | 14.2          | 218.0             | 5300.0      | MALE   |
| Adelie    | Dream     | 35.7           | 18.0          | 202.0             | 3550.0      | FEMALE |
| Adelie    | Torgersen | 36.6           | 17.8          | 185.0             | 3700.0      | FEMALE |
| Chinstrap | Dream     | 55.8           | 19.8          | 207.0             | 4000.0      | MALE   |
| Adelie    | Dream     | 38.1           | 18.6          | 190.0             | 3700.0      | FEMALE |
| Adelie    | Dream     | 36.2           | 17.3          | 187.0             | 3300.0      | FEMALE |
| Adelie    | Dream     | 39.5           | 17.8          | 188.0             | 3300.0      | FEMALE |
| Gentoo    | Biscoe    | 42.6           | 13.7          | 213.0             | 4950.0      | FEMALE |
| Gentoo    | Biscoe    | 52.1           | 17.0          | 230.0             | 5550.0      | MALE   |
| Adelie    | Torgersen | 36.7           | 18.8          | 187.0             | 3800.0      | FEMALE |
</code></pre></div>
</div>
<ul>
<li><code>.mode markdown</code> and <code>.headers on</code> make the output more readable</li>
<li>These SQLite <a class="gl-ref" href="../glossary/#gl:admin_command" markdown="1">administrative commands</a>
    start with <code>.</code> and <em>aren&rsquo;t</em> part of the SQL standard<ul>
<li>PostgreSQL&rsquo;s special commands start with <code>\</code></li>
</ul>
</li>
<li>Each command must appear on a line of its own</li>
<li>Use <code>.help</code> for a complete list</li>
<li>And as mentioned earlier, use <code>.quit</code> to quit</li>
</ul>
<h2>Specifying Columns</h2>
<div class="language-sql" title="specify_columns.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span>
<span class="k">from</span><span class="w"> </span><span class="n">little_penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="specify_columns.out">
<div class="highlight"><pre><span></span><code>|  species  |  island   |  sex   |
|-----------|-----------|--------|
| Gentoo    | Biscoe    | MALE   |
| Adelie    | Dream     | FEMALE |
| Adelie    | Torgersen | FEMALE |
| Chinstrap | Dream     | MALE   |
| Adelie    | Dream     | FEMALE |
| Adelie    | Dream     | FEMALE |
| Adelie    | Dream     | FEMALE |
| Gentoo    | Biscoe    | FEMALE |
| Gentoo    | Biscoe    | MALE   |
| Adelie    | Torgersen | FEMALE |
</code></pre></div>
</div>
<ul>
<li>Specify column names separated by commas<ul>
<li>In any order</li>
<li>Duplicates allowed</li>
</ul>
</li>
<li>Line breaks encouraged for readability</li>
</ul>
<h2>Sorting</h2>
<div class="language-sql" title="sort.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">little_penguins</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="k">asc</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="sort.out">
<div class="highlight"><pre><span></span><code>|  species  |  sex   |  island   |
|-----------|--------|-----------|
| Gentoo    | MALE   | Biscoe    |
| Gentoo    | MALE   | Biscoe    |
| Gentoo    | FEMALE | Biscoe    |
| Chinstrap | MALE   | Dream     |
| Adelie    | FEMALE | Dream     |
| Adelie    | FEMALE | Dream     |
| Adelie    | FEMALE | Dream     |
| Adelie    | FEMALE | Dream     |
| Adelie    | FEMALE | Torgersen |
| Adelie    | FEMALE | Torgersen |
</code></pre></div>
</div>
<ul>
<li><code>order by</code> must follow <code>from</code> (which must follow <code>select</code>)</li>
<li><code>asc</code> is ascending, <code>desc</code> is descending<ul>
<li>Default is ascending, but please specify</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Write a SQL query to select the sex and body mass columns from the <code>little_penguins</code> in that order,
sorted such that the largest body mass appears first.</p>
<h2>Limiting Output</h2>
<ul>
<li>Full dataset has 344 rows</li>
</ul>
<div class="language-sql" title="limit.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">island</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="limit.out">
<div class="highlight"><pre><span></span><code>| species |  sex   |  island   |
|---------|--------|-----------|
| Adelie  |        | Dream     |
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
</code></pre></div>
</div>
<ul>
<li>Comments start with <code>--</code> and run to the end of the line</li>
<li><code>limit <em>N</em></code> specifies maximum number of rows returned by query</li>
</ul>
<h2>Paging Output</h2>
<div class="language-sql" title="page.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">island</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="page.out">
<div class="highlight"><pre><span></span><code>| species |  sex   |  island   |
|---------|--------|-----------|
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  |        | Torgersen |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
| Adelie  | FEMALE | Biscoe    |
</code></pre></div>
</div>
<ul>
<li><code>offset <em>N</em></code> must follow <code>limit</code></li>
<li>Specifies number of rows to skip from the start of the selection</li>
<li>So this query skips the first 3 and shows the next 10</li>
</ul>
<h2>Removing Duplicates</h2>
<div class="language-sql" title="distinct.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="distinct.out">
<div class="highlight"><pre><span></span><code>|  species  |  sex   |  island   |
|-----------|--------|-----------|
| Adelie    | MALE   | Torgersen |
| Adelie    | FEMALE | Torgersen |
| Adelie    |        | Torgersen |
| Adelie    | FEMALE | Biscoe    |
| Adelie    | MALE   | Biscoe    |
| Adelie    | FEMALE | Dream     |
| Adelie    | MALE   | Dream     |
| Adelie    |        | Dream     |
| Chinstrap | FEMALE | Dream     |
| Chinstrap | MALE   | Dream     |
| Gentoo    | FEMALE | Biscoe    |
| Gentoo    | MALE   | Biscoe    |
| Gentoo    |        | Biscoe    |
</code></pre></div>
</div>
<ul>
<li><code>distinct</code> keyword must appear right after <code>select</code><ul>
<li>SQL was supposed to read like English</li>
</ul>
</li>
<li>Shows distinct combinations</li>
<li>Blanks in <code>sex</code> column show missing data<ul>
<li>We&rsquo;ll talk about this in a bit</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Write a SQL query to select the islands and species
    from rows 50 to 60 inclusive of the <code>penguins</code> table.
    Your result should have 11 rows.</p>
</li>
<li>
<p>Modify your query to select distinct combinations of island and species
    from the same rows
    and compare the result to what you got in part 1.</p>
</li>
</ol>
<h2>Filtering Results</h2>
<div class="language-sql" title="filter.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Biscoe&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="filter.out">
<div class="highlight"><pre><span></span><code>| species |  sex   | island |
|---------|--------|--------|
| Adelie  | FEMALE | Biscoe |
| Adelie  | MALE   | Biscoe |
| Gentoo  | FEMALE | Biscoe |
| Gentoo  | MALE   | Biscoe |
| Gentoo  |        | Biscoe |
</code></pre></div>
</div>
<ul>
<li><code>where <em>condition</em></code> <a class="gl-ref" href="../glossary/#gl:filter" markdown="1">filters</a> the rows produced by selection</li>
<li>Condition is evaluated independently for each row</li>
<li>Only rows that pass the test appear in results</li>
<li>Use single quotes for <code>'text data'</code> and double quotes for <code>"weird column names"</code><ul>
<li>SQLite will accept double-quoted text data but <a href="https://sqlfluff.com/">SQLFluff</a> will complain</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Write a query to select the body masses from <code>penguins</code> that are less than 3000.0 grams.</p>
</li>
<li>
<p>Write another query to select the species and sex of penguins that weight less than 3000.0 grams.
    This shows that the columns displayed and those used in filtering are independent of each other.</p>
</li>
</ol>
<h2>Filtering with More Complex Conditions</h2>
<div class="language-sql" title="filter_and.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Biscoe&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;MALE&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="filter_and.out">
<div class="highlight"><pre><span></span><code>| species |  sex   | island |
|---------|--------|--------|
| Adelie  | FEMALE | Biscoe |
| Gentoo  | FEMALE | Biscoe |
</code></pre></div>
</div>
<ul>
<li><code>and</code>: both sub-conditions must be true</li>
<li><code>or</code>: either or both part must be true</li>
<li>Notice that the row for Gentoo penguins on Biscoe island with unknown (empty) sex didn&rsquo;t pass the test<ul>
<li>We&rsquo;ll talk about this in a bit</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Use the <code>not</code> operator to select penguins that are <em>not</em> Gentoos.</p>
</li>
<li>
<p>SQL&rsquo;s <code>or</code> is an <a class="gl-ref" href="../glossary/#gl:inclusive_or" markdown="1">inclusive or</a>:
    it succeeds if either <em>or both</em> conditions are true.
    SQL does not provide a specific operator for <a class="gl-ref" href="../glossary/#gl:exclusive_or" markdown="1">exclusive or</a>,
    which is true if either <em>but not both</em> conditions are true,
    but the same effect can be achieved using <code>and</code>, <code>or</code>, and <code>not</code>.
    Write a query to select penguins that are female <em>or</em> on Torgersen Island <em>but not both</em>.</p>
</li>
</ol>
<h2>Doing Calculations</h2>
<div class="language-sql" title="calculations.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">flipper_length_mm</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="calculations.out">
<div class="highlight"><pre><span></span><code>| flipper_length_mm / 10.0 | body_mass_g / 1000.0 |
|--------------------------|----------------------|
| 18.1                     | 3.75                 |
| 18.6                     | 3.8                  |
| 19.5                     | 3.25                 |
</code></pre></div>
</div>
<ul>
<li>Can do the usual kinds of arithmetic on individual values<ul>
<li>Calculation done for each row independently</li>
</ul>
</li>
<li>Column name shows the calculation done</li>
</ul>
<h2>Renaming Columns</h2>
<div class="language-sql" title="rename_columns.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">flipper_length_mm</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">flipper_cm</span><span class="p">,</span>
<span class="w">    </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">weight_kg</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">where_found</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="rename_columns.out">
<div class="highlight"><pre><span></span><code>| flipper_cm | weight_kg | where_found |
|------------|-----------|-------------|
| 18.1       | 3.75      | Torgersen   |
| 18.6       | 3.8       | Torgersen   |
| 19.5       | 3.25      | Torgersen   |
</code></pre></div>
</div>
<ul>
<li>Use <code><em>expression</em> as <em>name</em></code> to rename</li>
<li>Give result of calculation a meaningful name</li>
<li>Can also rename columns without modifying</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Write a single query that calculates and returns:</p>
<ol>
<li>A column called <code>what_where</code> that has the species and island of each penguin
    separated by a single space.</li>
<li>A column called <code>bill_ratio</code> that has the ratio of bill length to bill depth.</li>
</ol>
<p>You can use the <code>||</code> operator to concatenate text to solve part 1,
or look at <a href="https://sqlite.org/printf.html">the documentation for SQLite&rsquo;s <code>format()</code> function</a>.</p>
<h2 class="aside">Check Understanding</h2>
<figure id="select_concept_map">
<img src="./select_concept_map.svg" alt="box and arrow diagram of concepts related to selection"/>
<figcaption>Figure&nbsp;2.1: selection</figcaption>
</figure>

<h2>Calculating with Missing Values</h2>
<div class="language-sql" title="show_missing_values.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">flipper_length_mm</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">flipper_cm</span><span class="p">,</span>
<span class="w">    </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">weight_kg</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">where_found</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="show_missing_values.out">
<div class="highlight"><pre><span></span><code>| flipper_cm | weight_kg | where_found |
|------------|-----------|-------------|
| 18.1       | 3.75      | Torgersen   |
| 18.6       | 3.8       | Torgersen   |
| 19.5       | 3.25      | Torgersen   |
|            |           | Torgersen   |
| 19.3       | 3.45      | Torgersen   |
</code></pre></div>
</div>
<ul>
<li>SQL uses a special value <a class="gl-ref" href="../glossary/#gl:null" markdown="1"><code>null</code></a> to representing missing data<ul>
<li>Not 0 or empty string, but &ldquo;I don&rsquo;t know&rdquo;</li>
</ul>
</li>
<li>Flipper length and body weight not known for one of the first five penguins</li>
<li>&ldquo;I don&rsquo;t know&rdquo; divided by 10 or 1000 is &ldquo;I don&rsquo;t know&rdquo;</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Use SQLite&rsquo;s <code>.nullvalue</code> command
to change the printed representation of null to the string <code>null</code>
and then re-run the previous query.
When will displaying null as <code>null</code> be easier to understand?
When might it be misleading?</p>
<h2>Null Equality</h2>
<ul>
<li>Repeated from earlier</li>
</ul>
<div class="language-sql" title="filter.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Biscoe&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="filter.out">
<div class="highlight"><pre><span></span><code>| species |  sex   | island |
|---------|--------|--------|
| Adelie  | FEMALE | Biscoe |
| Adelie  | MALE   | Biscoe |
| Gentoo  | FEMALE | Biscoe |
| Gentoo  | MALE   | Biscoe |
| Gentoo  |        | Biscoe |
</code></pre></div>
</div>
<ul>
<li>If we ask for female penguins the row with the missing sex drops out</li>
</ul>
<div class="language-sql" title="null_equality.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Biscoe&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;FEMALE&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="null_equality.out">
<div class="highlight"><pre><span></span><code>| species |  sex   | island |
|---------|--------|--------|
| Adelie  | FEMALE | Biscoe |
| Gentoo  | FEMALE | Biscoe |
</code></pre></div>
</div>
<h2>Null Inequality</h2>
<ul>
<li>But if we ask for penguins that <em>aren&rsquo;t</em> female it drops out as well</li>
</ul>
<div class="language-sql" title="null_inequality.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Biscoe&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;FEMALE&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="null_inequality.out">
<div class="highlight"><pre><span></span><code>| species | sex  | island |
|---------|------|--------|
| Adelie  | MALE | Biscoe |
| Gentoo  | MALE | Biscoe |
</code></pre></div>
</div>
<h2>Ternary Logic</h2>
<div class="language-sql" title="ternary_logic.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="ternary_logic.out">
<div class="highlight"><pre><span></span><code>| null = null |
|-------------|
|             |
</code></pre></div>
</div>
<ul>
<li>If we don&rsquo;t know the left and right values, we don&rsquo;t know if they&rsquo;re equal or not</li>
<li>So the result is <code>null</code></li>
<li>Get the same answer for <code>null != null</code></li>
<li><a class="gl-ref" href="../glossary/#gl:ternary_logic" markdown="1">Ternary logic</a></li>
</ul>
<table>
  <tr>
    <th colspan="4">equality</th>
  </tr>
  <tr>
    <th></th>
    <th>X</th>
    <th>Y</th>
    <th>null</th>
  </tr>
  <tr>
    <th>X</th>
    <td>true</td>
    <td>false</td>
    <td>null</td>
  </tr>
  <tr>
    <th>Y</th>
    <td>false</td>
    <td>true</td>
    <td>null</td>
  </tr>
  <tr>
    <th>null</th>
    <td>null</td>
    <td>null</td>
    <td>null</td>
  </tr>
</table>

<h2>Handling Null Safely</h2>
<div class="language-sql" title="safe_null_equality.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="safe_null_equality.out">
<div class="highlight"><pre><span></span><code>| species | sex |  island   |
|---------|-----|-----------|
| Adelie  |     | Torgersen |
| Adelie  |     | Torgersen |
| Adelie  |     | Torgersen |
| Adelie  |     | Torgersen |
| Adelie  |     | Torgersen |
| Adelie  |     | Dream     |
| Gentoo  |     | Biscoe    |
| Gentoo  |     | Biscoe    |
| Gentoo  |     | Biscoe    |
| Gentoo  |     | Biscoe    |
| Gentoo  |     | Biscoe    |
</code></pre></div>
</div>
<ul>
<li>Use <code>is null</code> and <code>is not null</code> to handle null safely</li>
<li>Other parts of SQL handle nulls specially</li>
</ul>
<h2 class="exercise">Exercise</h2>
<ol>
<li>
<p>Write a query to find penguins whose body mass is known but whose sex is not.</p>
</li>
<li>
<p>Write another query to find penguins whose sex is known but whose body mass is not.</p>
</li>
</ol>
<h2 class="aside">Check Understanding</h2>
<figure id="missing_concept_map">
<img src="./missing_concept_map.svg" alt="box and arrow diagram of concepts related to null values in SQL"/>
<figcaption>Figure&nbsp;2.2: missing values</figcaption>
</figure>

<h2>Aggregating</h2>
<div class="language-sql" title="simple_sum.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_mass</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="simple_sum.out">
<div class="highlight"><pre><span></span><code>| total_mass |
|------------|
| 1437000.0  |
</code></pre></div>
</div>
<ul>
<li><a class="gl-ref" href="../glossary/#gl:aggregation" markdown="1">Aggregation</a> combines many values to produce one</li>
<li><code>sum</code> is an <a class="gl-ref" href="../glossary/#gl:aggregation_func" markdown="1">aggregation function</a></li>
<li>Combines corresponding values from multiple rows</li>
</ul>
<h2>Common Aggregation Functions</h2>
<div class="language-sql" title="common_aggregations.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="k">max</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">longest_bill</span><span class="p">,</span>
<span class="w">    </span><span class="k">min</span><span class="p">(</span><span class="n">flipper_length_mm</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">shortest_flipper</span><span class="p">,</span>
<span class="w">    </span><span class="k">avg</span><span class="p">(</span><span class="n">bill_length_mm</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">bill_depth_mm</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">weird_ratio</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="common_aggregations.out">
<div class="highlight"><pre><span></span><code>| longest_bill | shortest_flipper |   weird_ratio    |
|--------------|------------------|------------------|
| 59.6         | 172.0            | 2.56087082530644 |
</code></pre></div>
</div>
<ul>
<li>This actually shouldn&rsquo;t work:
    can&rsquo;t calculate maximum or average if any values are null</li>
<li>SQL does the useful thing instead of the right one</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>What is the average body mass of penguins that weight more than 3000.0 grams?</p>
<h2>Counting</h2>
<div class="language-sql" title="count_behavior.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">count_star</span><span class="p">,</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">count_specific</span><span class="p">,</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">sex</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">count_distinct</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="count_behavior.out">
<div class="highlight"><pre><span></span><code>| count_star | count_specific | count_distinct |
|------------|----------------|----------------|
| 344        | 333            | 2              |
</code></pre></div>
</div>
<ul>
<li><code>count(*)</code> counts rows</li>
<li><code>count(<em>column</em>)</code> counts non-null entries in column</li>
<li><code>count(distinct <em>column</em>)</code> counts distinct non-null entries</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>How many different body masses are in the penguins dataset?</p>
<h2>Grouping</h2>
<div class="language-sql" title="simple_group.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">average_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="simple_group.out">
<div class="highlight"><pre><span></span><code>|  average_mass_g  |
|------------------|
| 4005.55555555556 |
| 3862.27272727273 |
| 4545.68452380952 |
</code></pre></div>
</div>
<ul>
<li>Put rows in <a class="gl-ref" href="../glossary/#gl:group" markdown="1">groups</a> based on distinct combinations of values in columns specified with <code>group by</code></li>
<li>Then perform aggregation separately for each group</li>
<li>But which is which?</li>
</ul>
<h2>Behavior of Unaggregated Columns</h2>
<div class="language-sql" title="unaggregated_columns.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">average_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="unaggregated_columns.out">
<div class="highlight"><pre><span></span><code>|  sex   |  average_mass_g  |
|--------|------------------|
|        | 4005.55555555556 |
| FEMALE | 3862.27272727273 |
| MALE   | 4545.68452380952 |
</code></pre></div>
</div>
<ul>
<li>All rows in each group have the same value for <code>sex</code>, so no need to aggregate</li>
</ul>
<h2>Arbitrary Choice in Aggregation</h2>
<div class="language-sql" title="arbitrary_in_aggregation.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">body_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="arbitrary_in_aggregation.out">
<div class="highlight"><pre><span></span><code>|  sex   | body_mass_g |
|--------|-------------|
|        |             |
| FEMALE | 3800.0      |
| MALE   | 3750.0      |
</code></pre></div>
</div>
<ul>
<li>If we don&rsquo;t specify how to aggregate a column,
    SQLite chooses <em>any arbitrary value</em> from the group<ul>
<li>All penguins in each group have the same sex because we grouped by that, so we get the right answer</li>
<li>The body mass values are in the data but unpredictable</li>
<li>A common mistake</li>
</ul>
</li>
<li>Other database managers don&rsquo;t do this<ul>
<li>E.g., PostgreSQL complains that column must be used in an aggregation function</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Explain why the output of the previous query
has a blank line before the rows for female and male penguins.</p>
<p>Write a query that shows each distinct body mass in the penguin dataset
and the number of penguins that weigh that much.</p>
<h2>Filtering Aggregated Values</h2>
<div class="language-sql" title="filter_aggregation.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">average_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span>
<span class="k">having</span><span class="w"> </span><span class="n">average_mass_g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4000</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="filter_aggregation.out">
<div class="highlight"><pre><span></span><code>| sex  |  average_mass_g  |
|------|------------------|
|      | 4005.55555555556 |
| MALE | 4545.68452380952 |
</code></pre></div>
</div>
<ul>
<li>Using <code>having <em>condition</em></code> instead of <code>where <em>condition</em></code> for aggregates</li>
</ul>
<h2>Readable Output</h2>
<div class="language-sql" title="readable_aggregation.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">average_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span>
<span class="k">having</span><span class="w"> </span><span class="n">average_mass_g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4000</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="readable_aggregation.out">
<div class="highlight"><pre><span></span><code>| sex  | average_mass_g |
|------|----------------|
|      | 4005.6         |
| MALE | 4545.7         |
</code></pre></div>
</div>
<ul>
<li>Use <code>round(<em>value</em>, <em>decimals</em>)</code> to round off a number</li>
</ul>
<h2>Filtering Aggregate Inputs</h2>
<div class="language-sql" title="filter_aggregate_inputs.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">sex</span><span class="p">,</span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span>
<span class="w">        </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4000</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="mi">1</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">average_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sex</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="filter_aggregate_inputs.out">
<div class="highlight"><pre><span></span><code>|  sex   | average_mass_g |
|--------|----------------|
|        | 3362.5         |
| FEMALE | 3417.3         |
| MALE   | 3729.6         |
</code></pre></div>
</div>
<ul>
<li><code>filter (where <em>condition</em>)</code> applies to <em>inputs</em></li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Write a query that uses <code>filter</code> to calculate the average body masses
of heavy penguins (those over 4500 grams)
and light penguins (those under 3500 grams)
simultaneously.
Is it possible to do this using <code>where</code> instead of <code>filter</code>?</p>
<h2 class="aside">Check Understanding</h2>
<figure id="aggregate_concept_map">
<img src="./aggregate_concept_map.svg" alt="box and arrow diagram of concepts related to aggregation in SQL"/>
<figcaption>Figure&nbsp;2.3: aggregation</figcaption>
</figure>

<h2 class="aside">Creating In-memory Database</h2>
<div class="language-sh" title="in_memory_db.sh">
<div class="highlight"><pre><span></span><code>sqlite3<span class="w"> </span>:memory:
</code></pre></div>
</div>
<ul>
<li>&ldquo;Connect&rdquo; to an <a class="gl-ref" href="../glossary/#gl:in_memory_db" markdown="1">in-memory database</a><ul>
<li>Changes aren&rsquo;t saved to disk</li>
<li>Very useful for testing (discussed later)</li>
</ul>
</li>
</ul>
<h2>Creating Tables</h2>
<div class="language-sql" title="create_work_job.sql">
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">billable</span><span class="w"> </span><span class="nb">real</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">job</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">);</span>
</code></pre></div>
</div>
<ul>
<li><code>create table <em>name</em></code> followed by parenthesized list of columns</li>
<li>Each column is a name, a data type, and optional extra information<ul>
<li>E.g., <code>not null</code> prevents nulls from being added</li>
</ul>
</li>
<li><code>.schema</code> is <em>not</em> standard SQL</li>
<li>SQLite has added a few things<ul>
<li><code>create if not exists</code></li>
<li>upper-case keywords (SQL is case insensitive)</li>
</ul>
</li>
</ul>
<h2>Inserting Data</h2>
<div class="language-sql" title="populate_work_job.sql">
<div class="highlight"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="k">values</span>
<span class="p">(</span><span class="s1">&#39;calibrate&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">values</span>
<span class="p">(</span><span class="s1">&#39;mik&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;calibrate&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;mik&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;clean&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;mik&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;complain&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;po&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;clean&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;po&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;complain&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;tay&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;complain&#39;</span><span class="p">);</span>
</code></pre></div>
</div>
<div class="language-out" title="insert_values.out">
<div class="highlight"><pre><span></span><code>|   name    | billable |
|-----------|----------|
| calibrate | 1.5      |
| clean     | 0.5      |

| person |    job    |
|--------|-----------|
| mik    | calibrate |
| mik    | clean     |
| mik    | complain  |
| po     | clean     |
| po     | complain  |
| tay    | complain  |
</code></pre></div>
</div>
<h2 class="aside">Following Along</h2>
<ul>
<li><a href="https://github.com/gvwilson/sql-tutorial/raw/main/sql-tutorial.zip">Download the examples</a></li>
<li>Unzip that file</li>
<li>To re-create this database:<ul>
<li><code>.read create_work_job.sql</code></li>
<li><code>.read populate_work_job.sql</code></li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Using an in-memory database,
define a table called <code>notes</code> with two text columns <code>author</code> and <code>note</code>
and then add three or four rows.
Use a query to check that the notes have been stored
and that you can (for example) select by author name.</p>
<p>What happens if you try to insert too many or too few values into <code>notes</code>?
What happens if you insert a number instead of a string into the <code>note</code> field?</p>
<h2>Updating Rows</h2>
<div class="language-sql" title="update_work_job.sql">
<div class="highlight"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="k">work</span>
<span class="k">set</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tae&#39;</span>
<span class="k">where</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tay&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="update_rows.out">
<div class="highlight"><pre><span></span><code>| person |    job    |
|--------|-----------|
| mik    | calibrate |
| mik    | clean     |
| mik    | complain  |
| po     | clean     |
| po     | complain  |
| tae    | complain  |
</code></pre></div>
</div>
<ul>
<li>(Almost) always specify row(s) to update using <code>where</code><ul>
<li>Otherwise update all rows in table, which is usually not wanted</li>
</ul>
</li>
</ul>
<h2>Deleting Rows</h2>
<div class="language-sql" title="delete_rows.sql">
<div class="highlight"><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">work</span>
<span class="k">where</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tae&#39;</span><span class="p">;</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="delete_rows.out">
<div class="highlight"><pre><span></span><code>| person |    job    |
|--------|-----------|
| mik    | calibrate |
| mik    | clean     |
| mik    | complain  |
| po     | clean     |
| po     | complain  |
</code></pre></div>
</div>
<ul>
<li>Again, (almost) always specify row(s) to delete using <code>where</code></li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>What happens if you try to delete rows that don&rsquo;t exist
(e.g., all entries in <code>work</code> that refer to <code>juna</code>)?</p>
<h2>Backing Up</h2>
<div class="language-sql" title="backing_up.sql">
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">job</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">);</span>

<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">backup</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">person</span><span class="p">,</span>
<span class="w">    </span><span class="n">job</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span>
<span class="k">where</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tae&#39;</span><span class="p">;</span>

<span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">work</span>
<span class="k">where</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tae&#39;</span><span class="p">;</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">backup</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="backing_up.out">
<div class="highlight"><pre><span></span><code>| person |   job    |
|--------|----------|
| tae    | complain |
</code></pre></div>
</div>
<ul>
<li>We will explore another strategy based on <a class="gl-ref" href="../glossary/#gl:tombstone" markdown="1">tombstones</a> below</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Saving and restoring data as text:</p>
<ol>
<li>
<p>Re-create the <code>notes</code> table in an in-memory database
    and then use SQLite&rsquo;s <code>.output</code> and <code>.dump</code> commands
    to save the database to a file called <code>notes.sql</code>.
    Inspect the contents of this file:
    how has your data been stored?</p>
</li>
<li>
<p>Start a fresh SQLite session
    and load <code>notes.sql</code> using the <code>.read</code> command.
    Inspect the database using <code>.schema</code> and <code>select *</code>:
    is everything as you expected?</p>
</li>
</ol>
<p>Saving and restoring data in binary format:</p>
<ol>
<li>
<p>Re-create the <code>notes</code> table in an in-memory database once again
    and use SQLite&rsquo;s <code>.backup</code> command to save it to a file called <code>notes.db</code>.
    Inspect this file using <code>od -c notes.db</code> or a text editor that can handle binary data:
    how has your data been stored?</p>
</li>
<li>
<p>Start a fresh SQLite session
    and load <code>notes.db</code> using the <code>.restore</code> command.
    Inspect the database using <code>.schema</code> and <code>select *</code>:
    is everything as you expected?</p>
</li>
</ol>
<h2 class="aside">Check Understanding</h2>
<figure id="datamod_concept_map">
<img src="./datamod_concept_map.svg" alt="box and arrow diagram of concepts relatd to defining and modifying data"/>
<figcaption>Figure&nbsp;2.4: data definition and modification</figcaption>
</figure>

<h2>Combining Information</h2>
<div class="language-sql" title="cross_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="cross_join.out">
<div class="highlight"><pre><span></span><code>| person |    job    |   name    | billable |
|--------|-----------|-----------|----------|
| mik    | calibrate | calibrate | 1.5      |
| mik    | calibrate | clean     | 0.5      |
| mik    | clean     | calibrate | 1.5      |
| mik    | clean     | clean     | 0.5      |
| mik    | complain  | calibrate | 1.5      |
| mik    | complain  | clean     | 0.5      |
| po     | clean     | calibrate | 1.5      |
| po     | clean     | clean     | 0.5      |
| po     | complain  | calibrate | 1.5      |
| po     | complain  | clean     | 0.5      |
| tay    | complain  | calibrate | 1.5      |
| tay    | complain  | clean     | 0.5      |
</code></pre></div>
</div>
<ul>
<li>A <a class="gl-ref" href="../glossary/#gl:join" markdown="1">join</a> combines information from two tables</li>
<li><a class="gl-ref" href="../glossary/#gl:cross_join" markdown="1">cross join</a> constructs their cross product<ul>
<li>All combinations of rows from each</li>
</ul>
</li>
<li>Result isn&rsquo;t particularly useful: <code>job</code> and <code>name</code> values don&rsquo;t match<ul>
<li>I.e., the combined data has records whose parts have nothing to do with each other</li>
</ul>
</li>
</ul>
<h2>Inner Join</h2>
<div class="language-sql" title="inner_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="inner_join.out">
<div class="highlight"><pre><span></span><code>| person |    job    |   name    | billable |
|--------|-----------|-----------|----------|
| mik    | calibrate | calibrate | 1.5      |
| mik    | clean     | clean     | 0.5      |
| po     | clean     | clean     | 0.5      |
</code></pre></div>
</div>
<ul>
<li>Use <code><em>table</em>.<em>column</em></code> notation to specify columns<ul>
<li>A column can have the same name as a table</li>
</ul>
</li>
<li>Use <code>on <em>condition</em></code> to specify <a class="gl-ref" href="../glossary/#gl:join_condition" markdown="1">join condition</a></li>
<li>Since <code>complain</code> doesn&rsquo;t appear in <code>job.name</code>, none of those rows are kept</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Re-run the query shown above using <code>where job = name</code> instead of the full <code>table.name</code> notation.
Is the shortened form easier or harder to read
and more or less likely to cause errors?</p>
<h2>Aggregating Joined Data</h2>
<div class="language-sql" title="aggregate_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">job</span><span class="p">.</span><span class="n">billable</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pay</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">name</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="aggregate_join.out">
<div class="highlight"><pre><span></span><code>| person | pay |
|--------|-----|
| mik    | 2.0 |
| po     | 0.5 |
</code></pre></div>
</div>
<ul>
<li>Combines ideas we&rsquo;ve seen before</li>
<li>But Tay is missing from the table<ul>
<li>No records in the <code>job</code> table with <code>tay</code> as name</li>
<li>So no records to be grouped and summed</li>
</ul>
</li>
</ul>
<h2>Left Join</h2>
<div class="language-sql" title="left_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="left_join.out">
<div class="highlight"><pre><span></span><code>| person |    job    |   name    | billable |
|--------|-----------|-----------|----------|
| mik    | calibrate | calibrate | 1.5      |
| mik    | clean     | clean     | 0.5      |
| mik    | complain  |           |          |
| po     | clean     | clean     | 0.5      |
| po     | complain  |           |          |
| tay    | complain  |           |          |
</code></pre></div>
</div>
<ul>
<li>A <a class="gl-ref" href="../glossary/#gl:left_outer_join" markdown="1">left outer join</a> keeps all rows from the left table</li>
<li>Fills missing values from right table with null</li>
</ul>
<h2>Aggregating Left Joins</h2>
<div class="language-sql" title="aggregate_left_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">job</span><span class="p">.</span><span class="n">billable</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pay</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">name</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="aggregate_left_join.out">
<div class="highlight"><pre><span></span><code>| person | pay |
|--------|-----|
| mik    | 2.0 |
| po     | 0.5 |
| tay    |     |
</code></pre></div>
</div>
<ul>
<li>That&rsquo;s better, but we&rsquo;d like to see 0 rather than a blank</li>
</ul>
<h2>Coalescing Values</h2>
<div class="language-sql" title="coalesce.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">,</span>
<span class="w">    </span><span class="k">coalesce</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">job</span><span class="p">.</span><span class="n">billable</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pay</span>
<span class="k">from</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">job</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">name</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="n">person</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="coalesce.out">
<div class="highlight"><pre><span></span><code>| person | pay |
|--------|-----|
| mik    | 2.0 |
| po     | 0.5 |
| tay    | 0.0 |
</code></pre></div>
</div>
<ul>
<li><code>coalesce(<em>val1</em>, <em>val2</em>, …)</code> returns first non-null value</li>
</ul>
<h2 class="aside">Full Outer Join</h2>
<ul>
<li><a class="gl-ref" href="../glossary/#gl:full_outer_join" markdown="1">Full outer join</a> is the union of
    left outer join and <a class="gl-ref" href="../glossary/#gl:right_outer_join" markdown="1">right outer join</a></li>
<li>Almost the same as cross join, but consider:</li>
</ul>
<div class="language-sql" title="full_outer_join.sql">
<div class="highlight"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">);</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;light&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;heavy&#39;</span><span class="p">);</span>

<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">w</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">);</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="full_outer_join.out">
<div class="highlight"><pre><span></span><code>|   s   | w |
|-------|---|
| light |   |
| heavy |   |
</code></pre></div>
</div>
<ul>
<li>A cross join would produce empty result</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Find the least time each person spent on any job.
Your output should show that <code>mik</code> and <code>po</code> each spent 0.5 hours on some job.
Can you find a way to show the name of the job as well
using the SQL you have seen so far?</p>
<h2 class="aside">Check Understanding</h2>
<figure id="join_concept_map">
<img src="./join_concept_map.svg" alt="box and arrow diagram of concepts related to joining tables"/>
<figcaption>Figure&nbsp;2.5: join</figcaption>
</figure>
    </main>
    <footer>
  © 2024 <a href="https://third-bit.com/">Greg Wilson</a>
  &middot;
  <a href="../">home</a>
  &middot;
  <a href="https://github.com/gvwilson/sql-tutorial">repository</a>
  &middot;
  <a href="../license/">license</a>
</footer>

  </body>
</html>
